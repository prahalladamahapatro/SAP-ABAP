*&---------------------------------------------------------------------*
*& Report ZALVOOP2_U29
*&---------------------------------------------------------------------*
*&
*&---------------------------------------------------------------------*
REPORT zalvoop2_u29.

INITIALIZATION.
  PARAMETERS: p_mat TYPE matnr.

* step-1 - declaration of itab and str
  TYPES: BEGIN OF ty_mara,
           matnr TYPE matnr,
           ernam TYPE ernam,
           laeda TYPE laeda,
           pstat TYPE pstat_d,
         END OF ty_mara.

  TYPES: BEGIN OF ty_marc,
           matnr TYPE matnr,
           werks TYPE werks_d,
           mmsta TYPE mmsta,
           ekgrp TYPE ekgrp,
         END OF ty_marc.

  DATA: lt_mara     TYPE TABLE OF ty_mara,
        wa_mara     TYPE ty_mara,

        lt_marc     TYPE TABLE OF ty_marc,
        wa_marc     TYPE ty_marc,

        lt_final    TYPE TABLE OF zstrfinal2_u29,
        wa_final    TYPE zstrfinal2_u29,

        lt_fieldcat TYPE lvc_t_fcat,
        wa_fieldcat TYPE lvc_s_fcat.


START-OF-SELECTION.

* step-2 - select statement
  SELECT * FROM mara INTO CORRESPONDING FIELDS OF TABLE lt_mara
    WHERE matnr = p_mat.

  IF lt_mara IS NOT INITIAL.
    SELECT * FROM marc INTO CORRESPONDING FIELDS OF TABLE lt_marc
      FOR ALL ENTRIES IN lt_mara
      WHERE matnr = lt_mara-matnr.
  ENDIF.

  LOOP AT lt_mara INTO wa_mara.
    LOOP AT lt_marc INTO wa_marc WHERE matnr = wa_mara-matnr.
      wa_final-matnr = wa_mara-matnr.
      wa_final-ernam = wa_mara-ernam.
      wa_final-laeda = wa_mara-laeda.
      wa_final-pstat = wa_mara-pstat.
      wa_final-werks = wa_marc-werks.
      wa_final-mmsta = wa_marc-mmsta.
      wa_final-ekgrp = wa_marc-ekgrp.

      APPEND wa_final TO lt_final.
      CLEAR wa_final.
    ENDLOOP.
  ENDLOOP.

* step-3: creation of fieldcatalog using fm
  CALL FUNCTION 'LVC_FIELDCATALOG_MERGE'
    EXPORTING
*     I_BUFFER_ACTIVE  =
      i_structure_name = 'ZSTRFINAL2_U29'
*     I_CLIENT_NEVER_DISPLAY       = 'X'
*     I_BYPASSING_BUFFER           =
*     I_INTERNAL_TABNAME           =
    CHANGING
      ct_fieldcat      = lt_fieldcat
*   EXCEPTIONS
*     INCONSISTENT_INTERFACE       = 1
*     PROGRAM_ERROR    = 2
*     OTHERS           = 3
    .
  IF sy-subrc <> 0.
* Implement suitable error handling here
  ENDIF.

*  step-4: creation of object for the custom container class
  DATA: lo_custom TYPE REF TO cl_gui_custom_container.
  CREATE OBJECT lo_custom
    EXPORTING
*     parent                      =
      container_name              = 'CONTAIN'
*     style                       =
*     lifetime                    = lifetime_default
      repid                       = sy-repid
*     dynnr                       =
*     no_autodef_progid_dynnr     =
    EXCEPTIONS
      cntl_error                  = 1
      cntl_system_error           = 2
      create_error                = 3
      lifetime_error              = 4
      lifetime_dynpro_dynpro_link = 5
      OTHERS                      = 6.
  IF sy-subrc <> 0.
*   MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*              WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.

*  step-5: create the object for alv-grid class and pass the object of container class
  DATA: lo_grid TYPE REF TO cl_gui_alv_grid.
  CREATE OBJECT lo_grid
    EXPORTING
*     i_shellstyle      = 0
*     i_lifetime        =
      i_parent          = lo_custom
*     i_appl_events     = SPACE
*     i_parentdbg       =
*     i_applogparent    =
*     i_graphicsparent  =
*     i_name            =
*     i_fcat_complete   = SPACE
*     o_previous_sral_handler =
    EXCEPTIONS
      error_cntl_create = 1
      error_cntl_init   = 2
      error_cntl_link   = 3
      error_dp_create   = 4
      OTHERS            = 5.
  IF sy-subrc <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*            WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ENDIF.

*  step-6: call the set_table_for first_diaplay method using the grid calss object
  CALL METHOD lo_grid->set_table_for_first_display
*        EXPORTING
*          i_buffer_active               =
*          i_bypassing_buffer            =
*          i_consistency_check           =
*          i_structure_name              =
*          is_variant                    =
*          i_save                        =
*          i_default                     = 'X'
*          is_layout                     =
*          is_print                      =
*          it_special_groups             =
*          it_toolbar_excluding          =
*          it_hyperlink                  =
*          it_alv_graphics               =
*          it_except_qinfo               =
*          ir_salv_adapter               =
    CHANGING
*      here both outtab and fieldcat both are mandatory
      it_outtab                     = lt_final
      it_fieldcatalog               = lt_fieldcat
*     it_sort                       =
*     it_filter                     =
    EXCEPTIONS
      invalid_parameter_combination = 1
      program_error                 = 2
      too_many_lines                = 3
      OTHERS                        = 4.
  IF sy-subrc <> 0.
*       Implement suitable error handling here
  ENDIF.

*      step-7: call the screen to display the data
  CALL SCREEN '0025'.